## Модель Изинга на Go с автоматической генерацией графиков (gnuplot)

Репозиторий содержит реализацию классической двумерной модели Изинга на решётке \(L \times L\) с методом Монте‑Карло (алгоритм Метрополиса) и автоматическим построением графиков с помощью **gnuplot**.

Основная идея:

- есть **мозг** — пакет `ising` с физикой и алгоритмом Монте‑Карло;
- есть **дирижёр** — `cmd/run/main.go`, который прогоняет серию расчётов по наборам параметров и вызывает gnuplot;
- есть **рисовалка** — `plots/ising.plt`, универсальный gnuplot‑скрипт, который читает CSV и строит графики.

---

## Структура проекта

```text
.
├── cmd/
│   └── run/
│       └── main.go        # Точка входа: перебор параметров, запуск модели и gnuplot
├── ising/
│   └── ising.go          # Пакет с моделью Изинга и функцией RunIsing
├── plots/
│   └── ising.plt         # gnuplot-скрипт для построения графиков из CSV
├── results/              # (создаётся при первом запуске) CSV-файлы результатов
├── go.mod                # Go-модуль (ising_project)
└── README.md             # Это описание
```

### `ising/ising.go` — пакет модели

Содержит всю физику и Монте‑Карло:

- **тип параметров**

```go
type Params struct {
    L      int     // размер решётки L×L
    T1     float64 // начальная температура
    T2     float64 // конечная температура
    Tcount int     // число точек по температуре

    ASteps int // шаги термализации
    MSteps int // шаги измерения
    Copies int // количество независимых копий решётки
}
```

- **тип строки результата**

```go
type ResultRow struct {
    T float64 // температура
    U float64 // энергия на спин
    M float64 // магнитизация на спин
    C float64 // теплоёмкость на спин
    X float64 // магнитная восприимчивость на спин
}
```

- **основная функция моделирования**

```go
func RunIsing(J, h float64, params Params) ([]ResultRow, error)
```

Что делает `RunIsing`:

- создаёт `Copies` независимых решёток размером `L×L` (начальное состояние: все спины `+1`);
- для каждой температуры от `T1` до `T2` (всего `Tcount` точек):
  - выполняет `ASteps` шагов термализации;
  - затем `MSteps` измерительных шагов;
  - на каждом измерительном шаге считает полную энергию и намагниченность решётки;
  - усредняет по шагам и по копиям;
- возвращает срез `[]ResultRow` с колонками `T, U, M, C, X`.

Формулы для
\( U, C, m, X \)
повторяют исходную реализацию:

- \( U = \frac{\langle E \rangle}{N} \),
- \( C = \frac{\langle E^2 \rangle - \langle E \rangle^2}{T^2 N} \),
- \( m = \frac{\langle |M| \rangle}{N} \),
- \( \chi = \frac{\langle M^2 \rangle - \langle M \rangle^2}{T N} \),

где \( N = L^2 \).

### `cmd/run/main.go` — дирижёр эксперимента

Файл `cmd/run/main.go` — это основная точка входа для запуска серии расчётов и построения графиков.

Внутри:

- задаются параметры моделирования:

```go
params := ising.Params{
    L:      8,
    T1:     5.0,
    T2:     0.1,
    Tcount: 10,
    ASteps: 15000,
    MSteps: 20000,
    Copies: 25,
}
```

- задаются значения связи и поля:

```go
Jvalues := []float64{1, -1}
Hmin, Hmax, Hstep := -5.0, 5.0, 1.0
```

- для каждого сочетания \((J, h)\):
  - вызывается `ising.RunIsing(J, h, params)`;
  - результаты пишутся в CSV:

```text
results/results_J_<J>_h_<H>.csv
```

  - формат файла:

```text
T;U;M;C;X
```

  - после записи вызывается gnuplot:

```bash
gnuplot -e "file='results/RESULTS_J_1_h_0.csv'" plots/ising.plt
```

Gnuplot читает CSV и сразу сохраняет PNG‑графики.

### `plots/ising.plt` — gnuplot‑скрипт

Скрипт ожидает, что ему передадут имя файла CSV через переменную `file`:

```bash
gnuplot -e "file='results/results_J_1_h_0.csv'" plots/ising.plt
```

Основные настройки в скрипте:

- разделитель `;` (как в CSV);
- три графика, каждый сохраняется в PNG:
  - **энергия**: `E_<file>.png` по столбцам `1:2` (T, U);
  - **теплоёмкость**: `C_<file>.png` по столбцам `1:4` (T, C);
  - **магнитизация**: `M_<file>.png` по столбцам `1:3` (T, M).

Имена файлов включают исходный путь `file`, так что можно легко понять, какие графики к какому CSV относятся.

---

## Установка и зависимости

Требуется:

- **Go** 1.20+ (в `go.mod` указан 1.22, но проект простой и должен собираться и на более свежих версиях);
- **gnuplot** установленный в системе и доступный в `PATH` (команда `gnuplot`).

Клонирование репозитория:

```bash
git clone <url-репозитория>.git
cd ising_project
```

Загрузка (если нужно) зависимостей Go:

```bash
go mod tidy
```

---

## Как запустить расчёты и построить графики

1. Убедитесь, что `gnuplot` установлен и команда `gnuplot` запускается из терминала.
2. Из корня репозитория выполните:

```bash
go run ./cmd/run
```

Что произойдёт:

- создастся папка `results/` (если её ещё нет);
- для всех \((J, h)\) из:

```text
J ∈ {1, -1}
h ∈ {-5, -4, …, 5}
```

  будет запущена модель;
- для каждого набора параметров:
  - будет записан один CSV в `results/`:

    ```text
    results_J_1_h_0.csv
    results_J_-1_h_3.csv
    ...
    ```

  - сразу же будут построены три PNG‑графика:

    ```text
    E_results/results_J_1_h_0.csv.png
    C_results/results_J_1_h_0.csv.png
    M_results/results_J_1_h_0.csv.png
    ```

---

## Как менять параметры эксперимента

Все основные параметры собраны в `cmd/run/main.go` и `ising/ising.go`.

- **Размер решётки**:

```go
params.L = 16 // было 8
```

- **Диапазон температур**:

```go
params.T1 = 5.0   // начальная температура
params.T2 = 0.1   // конечная температура
params.Tcount = 20 // больше точек по T
```

- **Шаги термализации и измерения**:

```go
params.ASteps = 20000
params.MSteps = 50000
```

- **Число независимых копий**:

```go
params.Copies = 50
```

- **Набор J и диапазон поля h**:

```go
Jvalues := []float64{1, -1}
Hmin, Hmax, Hstep := -5.0, 5.0, 1.0
```

Можно:

- добавить больше значений `J` (например, `[]float64{1, -1, 0.5}`);
- изменить шаг по полю `Hstep` (например, `0.5` вместо `1.0`);
- сузить/расширить диапазон поля.

---

## Как использовать свои собственные скрипты gnuplot

Если у вас уже есть свои `.plt`‑скрипты:

- можно продолжить использовать их, указывая в них путь к свежесгенерированным CSV из `results/`;
- можно взять `plots/ising.plt` как шаблон:
  - оставить чтение `file` через `-e "file='...'"`;
  - заменить команды `plot` и оформление под свои вкусы.

Пример ручного вызова gnuplot для одной серии:

```bash
gnuplot -e "file='results/results_J_1_h_0.csv'" plots/ising.plt
```

---

## Быстрый чек‑лист

- **Изменить физику / метод Монте‑Карло** → файл `ising/ising.go`.
- **Изменить параметры серии расчётов (сетка по T, J, h)** → файл `cmd/run/main.go`.
- **Изменить вид графиков (цвета, стили, подписи)** → файл `plots/ising.plt`.
- **Посмотреть результаты** → CSV и PNG‑файлы в папке `results/`.


